{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sam_Bhatti/Desktop/code%20%283%29/lib/auth-utils.ts"],"sourcesContent":["export const AUTH_TOKEN_KEY = \"rahmah_admin_token\"\r\n\r\n// Save token in cookies and localStorage\r\nexport function setAuthToken(token: string): void {\r\n  if (typeof window === \"undefined\") return\r\n  localStorage.setItem(AUTH_TOKEN_KEY, token)\r\n  // Cookie expires in 1 hour for middleware\r\n  document.cookie = `${AUTH_TOKEN_KEY}=${token}; path=/; max-age=3600; secure; samesite=lax`\r\n}\r\n\r\n// Get token from localStorage or cookies\r\nexport function getAuthToken(): string | null {\r\n  if (typeof window === \"undefined\") return null\r\n  // Try localStorage first (client-side preference)\r\n  const token = localStorage.getItem(AUTH_TOKEN_KEY)\r\n  if (token) return token\r\n\r\n  // Fall back to cookies\r\n  const match = document.cookie.match(new RegExp(\"(^| )\" + AUTH_TOKEN_KEY + \"=([^;]+)\"))\r\n  return match ? match[2] : null\r\n}\r\n\r\n// Remove token from both storage locations\r\nexport function removeAuthToken(): void {\r\n  if (typeof window === \"undefined\") return\r\n  localStorage.removeItem(AUTH_TOKEN_KEY)\r\n  document.cookie = `${AUTH_TOKEN_KEY}=; path=/; max-age=0`\r\n}\r\n\r\n// Client-side helper\r\nexport function isAuthenticated(): boolean {\r\n  return !!getAuthToken()\r\n}\r\n\r\nexport const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL\r\n\r\nexport async function authenticatedFetch(url: string, options: RequestInit = {}) {\r\n  const token = getAuthToken()\r\n  const headers = new Headers(options.headers || {})\r\n\r\n  if (token) {\r\n    headers.set(\"Authorization\", `Bearer ${token}`)\r\n  }\r\n\r\n  return fetch(url, {\r\n    ...options,\r\n    headers,\r\n  })\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAO,MAAM,iBAAiB;AAGvB,SAAS,aAAa,KAAa;IACxC,wCAAmC;;;AAIrC;AAGO,SAAS;IACd,wCAAmC,OAAO;;;IAC1C,kDAAkD;IAClD,MAAM;IAGN,uBAAuB;IACvB,MAAM;AAER;AAGO,SAAS;IACd,wCAAmC;;;AAGrC;AAGO,SAAS;IACd,OAAO,CAAC,CAAC;AACX;AAEO,MAAM;AAEN,eAAe,mBAAmB,GAAW,EAAE,UAAuB,CAAC,CAAC;IAC7E,MAAM,QAAQ;IACd,MAAM,UAAU,IAAI,QAAQ,QAAQ,OAAO,IAAI,CAAC;IAEhD,IAAI,OAAO;QACT,QAAQ,GAAG,CAAC,iBAAiB,CAAC,OAAO,EAAE,OAAO;IAChD;IAEA,OAAO,MAAM,KAAK;QAChB,GAAG,OAAO;QACV;IACF;AACF","debugId":null}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Sam_Bhatti/Desktop/code%20%283%29/app/staff/dashboard/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport type React from \"react\"\r\nimport { useEffect, useState } from \"react\"\r\nimport Link from \"next/link\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { CheckCircle2, TrendingUp, FileText, Heart, LogOut, Shield } from \"lucide-react\"\r\nimport { removeAuthToken, getAuthToken, API_BASE_URL, authenticatedFetch } from \"@/lib/auth-utils\"\r\n\r\ntype ZakatApplicant = {\r\n  id?: string | number\r\n  status?: string\r\n  createdAt?: string\r\n  normalizedStatus?: string\r\n  [key: string]: any\r\n}\r\n\r\ntype StatCardProps = {\r\n  title: string\r\n  value: string | number\r\n  icon: React.ReactNode\r\n  color?: string\r\n}\r\n\r\ntype StatusRowProps = {\r\n  label: string\r\n  value: number\r\n  color: string\r\n}\r\n\r\nexport default function DashboardPage() {\r\n  const [activeTab] = useState(\"overview\")\r\n  const [applicants, setApplicants] = useState<ZakatApplicant[]>([])\r\n  const [totalFromAPI, setTotalFromAPI] = useState<number | null>(null)\r\n  const [loading, setLoading] = useState(true)\r\n  const router = useRouter()\r\n\r\n  useEffect(() => {\r\n    const token = getAuthToken()\r\n    if (!token) {\r\n      router.push(\"/staff/login\")\r\n      return\r\n    }\r\n  }, [router])\r\n\r\n  const normalizeStatus = (status?: string) => {\r\n    return (status || \"\").toString().trim().toLowerCase().replace(/\\s+/g, \" \")\r\n  }\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      const token = getAuthToken()\r\n      if (token) {\r\n        await authenticatedFetch(`${API_BASE_URL}/api/auth/logout`, {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n        }).catch(() => {})\r\n      }\r\n      removeAuthToken()\r\n      router.push(\"/staff/login\")\r\n    } catch (err) {\r\n      console.error(\"Logout failed:\", err)\r\n      removeAuthToken()\r\n      router.push(\"/staff/login\")\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    const fetchApplicants = async () => {\r\n      try {\r\n        const res = await authenticatedFetch(`${API_BASE_URL}/api/zakat-applicants`)\r\n        const json = await res.json()\r\n\r\n        const dataArray: any[] = Array.isArray(json) ? json : json.items || json.data || []\r\n\r\n        const normalizedArray: ZakatApplicant[] = dataArray.map((a) => ({\r\n          ...a,\r\n          normalizedStatus: normalizeStatus(a?.status),\r\n        }))\r\n\r\n        setApplicants(normalizedArray)\r\n\r\n        if (typeof json.total === \"number\") {\r\n          setTotalFromAPI(json.total)\r\n        } else if (typeof json.totalCount === \"number\") {\r\n          setTotalFromAPI(json.totalCount)\r\n        } else {\r\n          setTotalFromAPI(normalizedArray.length)\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error fetching applicants:\", error)\r\n        setApplicants([])\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n\r\n    fetchApplicants()\r\n  }, [])\r\n\r\n  const approvedCount = applicants.filter((app) => app.normalizedStatus === \"approved\").length\r\n  const pendingCount = applicants.filter((app) => app.normalizedStatus === \"pending\").length\r\n  const rejectedCount = applicants.filter((app) => app.normalizedStatus === \"rejected\").length\r\n\r\n  const todayISO = new Date().toISOString().split(\"T\")[0]\r\n  const todaysSubmissions = applicants.filter((app) => {\r\n    if (!app.createdAt) return false\r\n    try {\r\n      const createdISO = new Date(app.createdAt).toISOString().split(\"T\")[0]\r\n      return createdISO === todayISO\r\n    } catch {\r\n      return app.createdAt?.toString().startsWith(todayISO)\r\n    }\r\n  }).length\r\n\r\n  const uniqueStatuses = [...new Set(applicants.map((a) => a.normalizedStatus || \"\"))]\r\n    .filter(Boolean)\r\n    .sort()\r\n    .map((s) => s.charAt(0).toUpperCase() + s.slice(1))\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-b from-gray-50 to-gray-100\">\r\n      {/* Header */}\r\n      <header className=\"bg-white border-b border-gray-200 px-8 py-6 shadow-sm\">\r\n        <div className=\"max-w-7xl mx-auto flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"w-10 h-10 bg-gradient-to-br from-teal-600 to-cyan-600 rounded-full flex items-center justify-center shadow-lg\">\r\n              <Heart className=\"w-6 h-6 text-white fill-white\" />\r\n            </div>\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-gray-900\">Admin Dashboard</h1>\r\n              <p className=\"text-sm text-gray-500\">Case Management System</p>\r\n            </div>\r\n          </div>\r\n          <button\r\n            onClick={handleLogout}\r\n            className=\"flex items-center gap-2 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-red-50 hover:text-red-600 rounded-lg transition font-medium\"\r\n          >\r\n            <LogOut className=\"w-4 h-4\" />\r\n            Logout\r\n          </button>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"max-w-7xl mx-auto px-8 py-12\">\r\n        {activeTab === \"overview\" && (\r\n          <div>\r\n            <div className=\"mb-8\">\r\n              <h2 className=\"text-3xl font-bold text-gray-900 mb-2\">Welcome Back</h2>\r\n              <p className=\"text-gray-600\">Here's an overview of pending applications</p>\r\n            </div>\r\n\r\n            {loading ? (\r\n              <div className=\"bg-white rounded-lg p-12 text-center\">\r\n                <p className=\"text-gray-600\">Loading dashboard...</p>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12\">\r\n                  <StatCard\r\n                    title=\"Total Applications\"\r\n                    value={totalFromAPI ?? applicants.length}\r\n                    icon={<FileText className=\"w-5 h-5\" />}\r\n                    color=\"from-blue-600 to-cyan-600\"\r\n                  />\r\n                  <StatCard\r\n                    title=\"Pending Review\"\r\n                    value={pendingCount}\r\n                    icon={<TrendingUp className=\"w-5 h-5\" />}\r\n                    color=\"from-yellow-600 to-orange-600\"\r\n                  />\r\n                  <StatCard\r\n                    title=\"Approved\"\r\n                    value={approvedCount}\r\n                    icon={<CheckCircle2 className=\"w-5 h-5\" />}\r\n                    color=\"from-green-600 to-emerald-600\"\r\n                  />\r\n                  <StatCard\r\n                    title=\"New Today\"\r\n                    value={todaysSubmissions}\r\n                    icon={<Shield className=\"w-5 h-5\" />}\r\n                    color=\"from-teal-600 to-cyan-600\"\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                  <div className=\"lg:col-span-2 bg-white rounded-lg p-8 shadow-sm border border-gray-200\">\r\n                    <h3 className=\"text-xl font-bold text-gray-900 mb-8\">Application Status</h3>\r\n                    <div className=\"space-y-6\">\r\n                      <StatusRow label=\"Pending\" value={pendingCount} color=\"from-yellow-500 to-orange-500\" />\r\n                      <StatusRow label=\"Approved\" value={approvedCount} color=\"from-green-500 to-emerald-500\" />\r\n                      <StatusRow label=\"Rejected\" value={rejectedCount} color=\"from-red-500 to-rose-500\" />\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"bg-white rounded-lg p-8 shadow-sm border border-gray-200\">\r\n                    <h3 className=\"text-xl font-bold text-gray-900 mb-6\">Quick Actions</h3>\r\n                    <div className=\"space-y-3\">\r\n                      <Link href=\"/staff/cases\">\r\n                        <button className=\"w-full px-6 py-3 border-2 border-teal-600 text-teal-600 rounded-lg font-medium hover:bg-teal-50 transition\">\r\n                          View All Cases\r\n                        </button>\r\n                      </Link>\r\n                      <div className=\"p-4 bg-blue-50 border border-blue-200 rounded-lg\">\r\n                        <p className=\"text-sm text-blue-800\">\r\n                          <span className=\"font-semibold\">{pendingCount}</span> applications awaiting review\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction StatCard({ title, value, icon, color = \"text-gray-900\" }: any) {\r\n  return (\r\n    <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200 hover:shadow-md transition\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-gray-600 font-medium\">{title}</h3>\r\n        <div className={`w-10 h-10 bg-gradient-to-br ${color} rounded-lg flex items-center justify-center text-white`}>\r\n          {icon}\r\n        </div>\r\n      </div>\r\n      <p className=\"text-4xl font-bold text-gray-900\">{value}</p>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction StatusRow({ label, value, color }: any) {\r\n  return (\r\n    <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-lg\">\r\n      <span className=\"text-gray-700 font-medium\">{label}</span>\r\n      <div className={`px-4 py-2 bg-gradient-to-r ${color} text-white rounded-lg font-semibold`}>{value}</div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}